# Data Sources

This project analyses arbitrage on Polymarket prediction markets, replicating the methodology of [arXiv:2508.03474](https://arxiv.org/abs/2508.03474). The study period is **April 1, 2024 to March 31, 2025**.

All data is cached locally under `cache/` after initial retrieval.

## 1. Blockchain Events

**Source:** Polygon PoS blockchain via JSON-RPC (`eth_getLogs`)

**Default RPC:** `https://polygon.drpc.org` (free, no API key). Alchemy is also supported with `--rpc-preset alchemy` (requires `ALCHEMY_API_KEY` env var).

Three event types are fetched from two contracts:

### OrderFilled Events

Executed trades on the Polymarket order book. Each event contains maker/taker addresses, asset IDs, and amounts.

| Field | Value |
|-------|-------|
| Contract | CTF Exchange: `0x4bFb41d5B3570DeFd03C39a9A4D8dE6Bd8B8982E` |
|          | NegRisk CTF Exchange: `0xC5d563A36AE78145C45a50134d48A1215220f80a` |
| Event signature | `0xd0a08e8c493f9c94f29311604c9de1b4e8c8d4c06bd0c789af57f2d65bfec0f6` |
| Used in | Section 6 (VWAP / arbitrage opportunity detection), Section 7 (trade execution) |

### PositionSplit Events

A user locks USDC collateral to mint paired YES/NO outcome tokens (1 USDC → 1 YES + 1 NO).

### PositionsMerge Events

A user burns paired YES/NO tokens to withdraw USDC collateral (1 YES + 1 NO → 1 USDC).

| Field | Value |
|-------|-------|
| Contract | Conditional Token Framework: `0x4D97DCd97eC945f40cF65F87097ACe5EA0476045` |
| PositionSplit signature | `0x2e6bb91f8cbcda0c93623c54d0403a43514fabc40084ec96b6d5379a74786298` |
| PositionsMerge signature | `0x6f13ca62553fcc2bcd2372180a43949c1e4cebba603901ede2f4e14f36b282ca` |
| Used in | Section 7 (reconstructing effective positions from split-then-sell patterns) |

### Cache Structure

```
cache/events/
├── ctf/          # OrderFilled from CTF Exchange
│   ├── 2024-04-01.json
│   └── ...
├── negrisk/      # OrderFilled from NegRisk CTF Exchange
│   ├── 2024-04-01.json
│   └── ...
└── ct/           # PositionSplit + PositionsMerge from Conditional Token
    ├── 2024-04-01.json
    └── ...
```

Each JSON file contains:
```json
{
  "date": "2024-04-01",
  "exchange": "ctf",
  "from_block": 55304250,
  "to_block": 55340808,
  "event_count": 12345,
  "events": [ ... ]
}
```

### Commands

```bash
# Fetch OrderFilled events (CTF + NegRisk exchanges)
uv run python fetch_events.py --source orders

# Fetch PositionSplit/PositionsMerge events (Conditional Token contract)
uv run python fetch_events.py --source ct

# Fetch all event types
uv run python fetch_events.py --source all

# Check cache status
uv run python fetch_events.py --status

# Resume from a specific date
uv run python fetch_events.py --source ct --start-from 2025-01-01

# Use Alchemy RPC (more reliable, requires API key)
ALCHEMY_API_KEY=... uv run python fetch_events.py --source all --rpc-preset alchemy
```

## 2. Market Metadata

**Source:** [Polymarket CLOB API](https://docs.polymarket.com/) via [py-clob-client](https://github.com/Polymarket/py-clob-client)

**Endpoint:** `https://clob.polymarket.com`

Market metadata maps token IDs (from blockchain events) to human-readable market info: condition IDs, questions, YES/NO token IDs, and whether the market uses neg-risk.

### Cache Structure

```
cache/
├── clob_markets.json       # All markets with token ID index (~747 MB)
└── market_metadata.json    # Compact market metadata
```

### Command

```bash
uv run python market_counter.py
```

## 3. Derived Data (Analysis Output)

Generated by the analysis scripts, stored under `cache/arbitrage_results/`:

| File | Source Script | Description |
|------|-------------|-------------|
| `arbitrage_single.json` | `analyze_arbitrage.py` | Section 6 arbitrage opportunities |
| `observations_single.parquet` | `analyze_arbitrage.py` | All VWAP observations |
| `summary_single.parquet` | `analyze_arbitrage.py` | Per-condition summary statistics |
| `conditions_single.parquet` | `analyze_arbitrage.py` | Condition metadata |
| `arbitrage_trades_single.parquet` | `analyze_arbitrage_trades.py` | Section 7 identified arbitrage executions |
